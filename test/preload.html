<!doctype HTML>
<html>
	<head>
		<title>Test for link[rel=preload]</title>
		<meta charset="utf-8">

		<link rel="preload" href="http://scottjehl.com/css-temp/slow.php" as="style" onload="this.rel='stylesheet'">
		<script>

		/* CSS rel=preload polyfill */
		(function( w ){
			// rel=preload support test
			function support(){
			  try {
					return w.document.createElement("link").relList.supports( "preload" );
			  } catch (e) {}
			}
			// loop preload links and fetch using loadCSS
			function poly(){
				var links = w.document.getElementsByTagName( "link" );
				for( var i = 0; i < links.length; i++ ){
					if( links[ i ].getAttribute( "rel" ) === "preload" ){
						w.loadCSS( links[ i ].href, links[ i ] );
						links[ i ].rel = null;
					}
				}
			}
			// if link[rel=preload] is not supported, we must fetch the CSS manually using loadCSS
			if( !support() ){
				poly();
				var run = w.setInterval( poly, 300 );
				if( w.addEventListener ){
					w.addEventListener( "load", function(){
						w.clearInterval( run );
					} )
				}
			}
		}( this ));

		</script>
	</head>
	<body>
		<p>This is a test page that references a stylesheet with <code>link[rel=prefetch]</code>, and fetches the CSS manually using <code>loadCSS</code> in browsers that do not understand <code>link[rel=prefetch]</code> yet (read: all browsers at time of writing)</p>

		<p>The CSS file  has a 5 second delay built into its server response time. If it is loaded in a non-blocking manner as desired, you should be able to read this text before the page is styled as white text on green background.</p>

</body>
</html>
